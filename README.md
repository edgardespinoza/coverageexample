# Данный проект демонстрирует внедрение отчета покрытия кода тестами и статического анализатора кода в Ваш проект. #

# Что такое: #
## Покрытие кода тестами ##

Мы надеемся, что Вы всегда пишите тесты в своем проекте и даже иногда используете TDD подход (хотя, возможно, это и излишне - мнение автора). Так вот, Вы же хотите контролировать эффективность написанных Вами тестов (ведь количество далеко не всегда - качество)? Написанный Вами тест может покрыть далеко не все варианты выполнения метода или их группы. Удобным инструментом ДОПОЛНИТЕЛЬНОГО анализа качества Ваших тестов является отчет о покрытии кода тестами. Данный отчет предоставляет подробную информацию о:  
- количестве строк, к которым обратилась Ваша программа при выполнении теста/ов  
- количество методов (см выше)  
- количество сценариев ветвления  
- т.п.  
Весь данный анализ может быть сгруппирован как для всей программы так и для отдельных пакетов, классов, методов.

## Статический анализ кода ##

Мы верим, что Ваша программа самая-самая, но какова вероятность, что Вы ничего не пропустили, что завтра (при масштабировании проекта) новый разработчик не будет плеваться на Ваш код и называть Вас самыми некрасивыми словами? 
Мы так же надеемся, что Вы соблюдаете гайд лаины:  
- [java](https://source.android.com/source/code-style.html)  
- [android/java](https://github.com/ribot/android-guidelines/blob/master/project_and_code_guidelines.md)  
Но, чтоб  Вам передалась наша уверенность в Вас, лучше проверьте себя))). И вот тут на помощь Вам и придет статический анализ кода. В нашей работе мы используем SonarQube и пока это является стандартом для нашей команды.
Данный сервис покажет Вам все недоработки, согласно с настроенными правилами, укажет, где Ваш код "пахнет", а где и "воняет"

## Как это включить покрытие кода в мой проект? ##
Итак, сразу необходимо оговориться, что данная страница написана андроид разработчиком и об андроид проекте.
В проектах Андроид существует сложность с объединением отчетов о покрытии кода UI тестов и юнит тестов. Поэтому нужен надежный бубен. Также в данном проекте приведена общая настройка таски Jacoco, которая может не включать нужные Вам исключения. 
Последовательность действий следующая:  

* Создайте проект  
* Напишите в нем тесты  
* добавьте в build.gradle в раздел android{} следующие строки: 

    
```
#!groovy

testOptions {
        unitTests.all {
            jacoco {
                includeNoLocationClasses = true
            }
        }
    }
```

и в настройки сборки


```
#!groovy

testCoverageEnabled true
```


* Создадим [таску](https://bitbucket.org/Sergey_Grechukha/coverageexample/src/7abc549e9c6b7f8d2411ce9afd0fe85b405c0844/app/jacoco.gradle?at=master&fileviewer=file-view-default) Jacoco (кстати, Jacoco и будет нам помогать в этом процессе). Обратите внимание, что фаил таски лежит в одной директории с фаилом build.gradle. Если у Вас будет как-то иначе, не забудьте изменить путь к таске при импорте в П.5  
* Теперь необходимо добавить данную таску в build.gradle в "шапку" файла:  
* Запустите таску (не забудьте подключить девайс) из консоли:  
    win - gradlew clean createDebugCoverageReport jacocoTestReport  
    mac - ./gradlew clean createDebugCoverageReport jacocoTestReport  
* Отчет лежит в YOUR_PROJECT_PATH\app\build\reports\jacoco\jacocoTestReport\html - изучайте

## Добавляем статический анализ проекта на базе SonarQube ##

Для удобства мы соединим приятное с полезным и внесем отчет по покрытию в SonarQube и тем самым убьем двух зайцев:

* получим красивый и удобный отчет по покрытию (он более наглядный, чем стандартный отчет Jacoco)
* Сведем все данные о качестве проекта в одну удобную форму

Для добавления статического анализа Вам понадобиться:
* установить сервер [SonarQube](http://www.sonarqube.org/downloads/). Или получить у администраторов адрес уже установленного сервера
* создать таску [sonarQube](https://bitbucket.org/Sergey_Grechukha/coverageexample/src/7abc549e9c6b7f8d2411ce9afd0fe85b405c0844/app/sonarqube.gradle?at=master&fileviewer=file-view-default) в Вашем проекте
* внести адрес Вашего сервера в таску


```
#!groovy

ext {
    SONAR_HOST = {change on your host}
}
```


* добавить таску в build.gradle (помним о расположении файлов)


```
#!groovy

apply from: './sonarqube.gradle'
```

* после выполнения таски по покрытию кода, запустите таску sonarQube

    win - gradlew clean createDebugCoverageReport jacocoTestReport sonarqube  
    mac - ./gradlew clean createDebugCoverageReport jacocoTestReport sonarqube

* теперь переходите на хост sonarQube, находите свой проект, и анализируйте
* не забудьте настроить правила приватности проекта в sonarQube
* также Вы можете настраивать различные правила проверки кода и допустимый уровень качества кода

В качестве теста, Вы можете взять проект из этого репозитория. В нем уже есть пару тестов и все настроено (кроме адреса sonarQube)  

Пусть Ваш код будет надежным, как скала и пахнет, как фиалка!  
May the force be with you!